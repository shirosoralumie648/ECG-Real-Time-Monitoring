# ECG-Real-Time-Monitoring
实时ECG监控系统，使用Python、Flask和Socket.IO开发。该项目包括ECG信号处理、特征提取和可视化功能。

## 项目架构

### 整体架构

```
+----------------------------------+
|           前端应用层              |
|  +------------+  +------------+  |
|  | Web界面    |  | 移动应用    |  |
|  +------------+  +------------+  |
+----------------------------------+
              |
              | HTTP/WebSocket
              |
+----------------------------------+
|           API网关层               |
|  +------------+  +------------+  |
|  | 认证授权    |  | 请求路由    |  |
|  +------------+  +------------+  |
+----------------------------------+
              |
              | 内部通信
              |
+-------------------------------------------------------+
|                     微服务层                           |
| +------------+ +------------+ +----------------+      |
| | 用户服务   | | 患者服务   | | 设备连接服务    |      |
| +------------+ +------------+ +----------------+      |
|                                                       |
| +------------+ +------------+ +----------------+      |
| | 数据采集   | | 数据处理   | | 数据分析服务    |      |
| +------------+ +------------+ +----------------+      |
|                                                       |
| +------------+ +------------+ +----------------+      |
| | 报警服务   | | 存储服务   | | 报告生成服务    |      |
| +------------+ +------------+ +----------------+      |
+-------------------------------------------------------+
              |
              | 数据访问
              |
+-------------------------------------------------------+
|                     数据存储层                         |
| +------------+ +------------+ +----------------+      |
| | 时序数据库  | | 文档数据库 | | 关系型数据库    |      |
| | (InfluxDB) | | (MongoDB)  | | (PostgreSQL)    |      |
| +------------+ +------------+ +----------------+      |
|                                                       |
| +------------+ +------------+                         |
| | 缓存       | | 文件存储   |                         |
| | (Redis)    | | (MinIO)    |                         |
| +------------+ +------------+                         |
+-------------------------------------------------------+
```

### 各层详细设计

#### 1. 前端应用层

- **Web界面**：使用React/Vue + TypeScript构建，包含实时监控仪表盘、患者管理界面、数据分析与报告界面等
- **移动应用**：使用React Native/Flutter构建，支持远程监控、报警通知等功能

#### 2. API网关层

- 使用Nginx + Kong/Traefik实现
- 负责请求路由、认证授权、API版本控制等

#### 3. 微服务层

- **用户服务**：用户注册、认证、权限管理
- **患者服务**：患者信息管理、病历记录
- **设备连接服务**：管理串口、UDP、蓝牙等数据源连接
- **数据采集服务**：从设备读取原始数据
- **数据处理服务**：信号处理、滤波、特征提取
- **数据分析服务**：高级分析、异常检测、趋势分析
- **报警服务**：监控异常、生成报警、发送通知
- **存储服务**：管理数据存储、备份、归档
- **报告生成服务**：生成分析报告、导出数据

#### 4. 数据存储层

- **时序数据库(InfluxDB)**：存储原始ECG数据和处理后的时间序列
- **文档数据库(MongoDB)**：存储患者信息、分析结果、报告
- **关系型数据库(PostgreSQL)**：存储用户账户、权限、系统配置
- **缓存(Redis)**：存储会话数据、实时数据缓存
- **文件存储(MinIO)**：存储报告PDF、导出数据、系统日志

### 系统通信

- **同步通信**：REST API、GraphQL
- **异步通信**：WebSocket、消息队列(RabbitMQ/Kafka)

### 安全架构

- **数据安全**：传输加密(TLS/SSL)、存储加密、数据脱敏
- **访问控制**：基于角色的访问控制(RBAC)、多因素认证
- **合规性**：HIPAA合规设计、GDPR数据保护、审计日志记录

### 实施路线图

1. **第一阶段**：核心功能 - 数据采集与处理、基础用户管理、实时监控界面
2. **第二阶段**：分析与存储 - 数据库集成、基础分析功能、报告生成
3. **第三阶段**：高级功能 - AI辅助诊断、远程监控、多设备集成
4. **第四阶段**：完善与优化 - 性能优化、安全加固、合规认证

## 功能特性

- 实时ECG数据采集和可视化
- 支持多种数据源：串口、UDP、蓝牙、文件回放
- 数据源连接与监测分离，提高系统灵活性
- ECG信号预处理和清洗
- ECG信号特征提取和分析
- 心率变异性(HRV)分析
- ECG衍生呼吸(EDR)分析
- 多导联同时监测和切换
- 患者管理和数据关联
- 用户认证和权限控制

## 使用的技术

- **后端**：Python、Flask、Socket.IO、Eventlet
- **数据处理**：NeuroKit2、NumPy、SciPy、Pandas、BioSPPy
- **前端**：HTML5、CSS3、JavaScript、Chart.js
- **数据库**：InfluxDB（时序数据）、MongoDB（患者数据）、Redis（缓存）
- **安全**：Flask-Login、JWT、Bcrypt
- **设备通信**：PySerial、Socket、PyBluez（可选）

## 安装

1. 克隆仓库：
    ```bash
    git clone https://github.com/vtuberfan/ECG-Real-Time-Monitoring.git
    cd ECG-Real-Time-Monitoring
    ```

2. 创建虚拟环境并激活：
    ```bash
    python -m venv venv
    source venv/bin/activate  # 在Windows上使用 `venv\Scripts\activate`
    ```

3. 安装依赖包：
    ```bash
    pip install -r requirements.txt
    ```

4. 安装蓝牙支持（可选）：
    ```bash
    # 安装系统依赖
    sudo apt install libbluetooth-dev python3-dev
    
    # 安装PyBluez
    sudo pip3 install git+https://github.com/pybluez/pybluez.git#egg=pybluez
    ```

## 使用说明

### 快速启动

使用提供的启动脚本可以快速启动系统：

```bash
./start.sh
```

或者手动执行以下步骤：

1. 激活虚拟环境：
```bash
source venv/bin/activate  # Linux/Mac
# 或
venv\Scripts\activate  # Windows
```

2. 启动服务器：
```bash
python -m backend.main
```

3. 在浏览器中访问 http://localhost:5000

### 连接数据源

1. 在Web界面上选择数据源类型（串口、UDP、蓝牙、文件）
2. 配置数据源参数：
   - **串口**：选择端口和波特率
   - **UDP**：配置本地IP和端口，可选远程IP和端口
   - **蓝牙**：选择蓝牙设备和波特率
   - **文件**：选择包含ECG数据的文件
3. 点击"连接"按钮

### 开始监测

1. 连接成功后，可以选择一个患者（可选）
2. 点击"开始监测"按钮
3. ECG波形将在图表区域实时显示
4. 可以通过导联选择器切换不同的导联视图

### 停止监测

1. 点击"停止监测"按钮可以暂停数据采集和显示
2. 停止监测后，数据源仍然保持连接状态
3. 可以随时再次点击"开始监测"继续监测

### 断开连接

1. 点击"断开连接"按钮可以完全断开与数据源的连接

## 文件结构

```
ECG-Real-Time-Monitoring/
├── backend/                  # 后端代码
│   ├── api/                  # API路由
│   │   ├── __init__.py       # API初始化
│   │   ├── auth_routes.py    # 认证相关API
│   │   ├── patient_routes.py # 患者相关API
│   │   ├── monitor_routes.py # 监控相关API
│   │   ├── analysis_routes.py# 分析相关API
│   │   └── device_routes.py  # 设备相关API
│   ├── services/             # 服务层
│   │   ├── user_service.py   # 用户服务
│   │   ├── patient_service.py# 患者服务
│   │   └── monitoring_service.py # 监控服务
│   ├── data/                 # 数据层
│   │   ├── models/           # 数据模型
│   │   │   ├── user.py       # 用户模型
│   │   │   └── patient.py    # 患者模型
│   │   ├── raw/              # 原始数据
│   │   ├── processed/        # 处理后数据
│   │   └── logs/             # 日志
│   ├── devices/              # 设备通信
│   │   ├── serial_reader.py  # 串口读取器
│   │   └── udp_reader.py     # UDP读取器
│   ├── processing/           # 数据处理
│   │   ├── ecg_data_processor.py # ECG数据处理器
│   │   └── ecg_signal_analyzer.py # ECG信号分析器
│   ├── utils/                # 工具函数
│   │   └── helpers.py        # 辅助函数
│   ├── app.py                # Flask应用
│   ├── main.py               # 入口文件
│   ├── config.py             # 配置文件
│   ├── database_manager.py   # 数据库管理器
│   └── init_project.py       # 项目初始化脚本
├── frontend/                 # 前端代码
│   ├── static/               # 静态资源
│   │   ├── css/              # 样式文件
│   │   │   └── monitor.css   # 监控页面样式
│   │   ├── js/               # JavaScript文件
│   │   │   ├── monitor.js    # 监控页面脚本
│   │   │   └── ecg-chart.js  # ECG图表脚本
│   │   └── images/           # 图片资源
│   └── templates/            # HTML模板
│       ├── index.html        # 主页
│       ├── home.html         # 首页
│       └── respiration.html  # 呼吸监测页面
├── docs/                     # 文档
├── tests/                    # 测试代码
│   ├── unit/                 # 单元测试
│   └── integration/          # 集成测试
├── requirements.txt          # 依赖列表
├── start.sh                  # 启动脚本
└── README.md                 # 项目说明
```

## 贡献

欢迎贡献！请提交问题或拉取请求。

## 许可证

本项目采用GPL-3.0许可证。详情请参阅`LICENSE`文件。
